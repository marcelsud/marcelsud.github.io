
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Service Decoration with Symfony 2/3</title>
    <meta name="description" content="">

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="apple-touch-icon" sizes="57x57" href="../assets/img/favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="../assets/img/favicons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="../assets/img/favicons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/favicons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="../assets/img/favicons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="../assets/img/favicons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="../assets/img/favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="../assets/img/favicons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="../assets/img/favicons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="../assets/img/favicons/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="../assets/img/favicons/android-chrome-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="../assets/img/favicons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="../assets/img/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="manifest" href="http://www.marcelsud.com/assets/img/favicons/manifest.json">
    <link rel="mask-icon" href="../assets/img/favicons/safari-pinned-tab.svg" color="#5bbad5">
    <link rel="shortcut icon" href="../assets/img/favicons/favicon.ico">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/assets/img/favicons/mstile-144x144.png">
    <meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css?v=b26ed48682">
    <link rel="stylesheet" type="text/css" href="../assets/css/custom.css?v=b26ed48682">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,400">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="../assets/css/prism.css?v=b26ed48682">
    <link rel="stylesheet" type="text/css" href="../assets/css/rrssb.css?v=b26ed48682">

    <link rel="canonical" href="http://marcelsud.com/service-decoration-with-symfony-2-3/">
    <meta name="referrer" content="origin">
    
    <meta property="og:site_name" content="Marcelo Santos (@marcelsud)">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Service Decoration with Symfony 2/3">
    <meta property="og:description" content='One of the least used features on Symfony is the "Service Decorator" feature. It makes the process of creating a "Decorator" (Design Patterns) a way simpler task. The idea of the Decorator pattern is to "add behavior to an existing...'>
    <meta property="og:url" content="http://marcelsud.com/service-decoration-with-symfony-2-3/">
    <meta property="article:published_time" content="2017-08-04T19:23:25.678Z">
    <meta property="article:modified_time" content="2017-08-04T19:36:54.094Z">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Service Decoration with Symfony 2/3">
    <meta name="twitter:description" content='One of the least used features on Symfony is the "Service Decorator" feature. It makes the process of creating a "Decorator" (Design Patterns) a way simpler task. The idea of the Decorator pattern is to "add behavior to an existing...'>
    <meta name="twitter:url" content="http://marcelsud.com/service-decoration-with-symfony-2-3/">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Marcelo Santos (@marcelsud)",
    "author": {
        "@type": "Person",
        "name": "Marcelo Santos",
        "image": "http://marcelsud.com/content/images/2017/08/profile_licture.jpg",
        "url": "http://marcelsud.com/author/marcelsud",
        "sameAs": "http://marcelsud.com",
        "description": "PHP Developer, Symfony lover, Geek, Husband and Dad!"
    },
    "headline": "Service Decoration with Symfony 2/3",
    "url": "http://marcelsud.com/service-decoration-with-symfony-2-3/",
    "datePublished": "2017-08-04T19:23:25.678Z",
    "dateModified": "2017-08-04T19:36:54.094Z",
    "description": "One of the least used features on Symfony is the &quot;Service Decorator&quot; feature. It makes the process of creating a &quot;Decorator&quot; (Design Patterns) a way simpler task. The idea of the Decorator pattern is to &quot;add behavior to an existing..."
}
    </script>

    <meta name="generator" content="Ghost 0.7">
    <link rel="alternate" type="application/rss+xml" title="Marcelo Santos (@marcelsud)" href="http://marcelsud.com/rss/">
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/darkula.min.css">  
<style>  
  pre {
    word-wrap: normal;
    -moz-hyphens: none;
    -ms-hyphens: none;
    -webkit-hyphens: none;
    hyphens: none;
    font-size: 0.8em;
    line-height: 1.3em;
  }
  pre code, pre tt {
    white-space: pre;
  }
</style>    
<script type="text/javascript">var ga_id = "UA-52146211-1";</script>
</head>
<body class="post-template">


    <div class="site-wrapper">

        


<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="back-button icon-arrow-left" href="../"> Home</a>
        <a class="subscribe-button icon-feed" href="http://marcelsud.com/rss/"> Subscribe</a>
    </nav>
</header>

<main class="content" role="main">
    <article class="post">

        <header class="post-header">
            <h1 class="post-title">Service Decoration with Symfony 2/3</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2017-08-04">04 August 2017</time> 
            </section>
        </header>

        <section class="post-content">
            <p>One of the least used features on <a href="https://symfony.com/">Symfony</a> is the "Service Decorator" feature. It makes the process of creating a "<a href="https://en.wikipedia.org/wiki/Decorator_pattern">Decorator</a>" (Design Patterns) a way simpler task.</p>

<p>The idea of the Decorator pattern is to "add behavior to an existing object in runtime".</p>

<p>Let's assume we have a repository called "UserRepository":</p>

<pre><code class="language-php">&lt;?php

namespace App\UserBundle\Repository;

use Doctrine\ORM\EntityManagerInterface;  
use App\UserBundle\Entity\User;

class UserRepository implements UserRepositoryInterface  
{
    /**
     * @var EntityManagerInterface
     */
    private $entityManager;

    /**
     * @param EntityManagerInterface $entityManager
     */
    public function __construct(EntityManagerInterface $entityManager)
    {
        $this-&gt;entityManager = $entityManager;
    }

    /**
     * @param User $user
     */
    public function addUser(User $user)
    {
        $this-&gt;entityManager-&gt;persist($user);
        $this-&gt;entityManager-&gt;flush();
    }
}
</code></pre>

<p>Now let's suppose we need an event to be triggered when a new user is added and we don't want to couple the repository and the event dispatcher together.</p>

<p>Then we can use the <a href="https://symfony.com/">Decorator pattern</a> and composition to dispatch the event when needed, as you can see in the "DecoratedUserRepository":</p>

<pre><code class="language-php">&lt;?php

namespace App\UserBundle\Repository;

use App\ApplicationBundle\EventDispatcher\EventDispatcherInterface;  
use App\UserBundle\Entity\User;  
use App\UserBundle\Event\UserCreatedEvent;  
use App\UserBundle\Repository\UserRepository;

class DecoratedUserRepository implements UserRepositoryInterface  
{
    /**
     * @var UserRepository
     */
    private $userRepository;

    /**
     * @var EventDispatcherInterface
     */
    private $eventDispatcher;

    /**
     * @param UserRepository $userRepository
     * @param EventDispatcherInterface $eventDispatcher
     */
    public function __construct(
        UserRepository $userRepository,
        EventDispatcherInterface $eventDispatcher
    ) {
        $this-&gt;userRepository = $userRepository;
        $this-&gt;eventDispatcher = $eventDispatcher;
    }

    /**
     * @param User $user
     */
    public function addUser(User $user)
    {
        $this-&gt;userRepository-&gt;addUser($user);
        $this-&gt;eventDispatcher-&gt;dispatch(
            'app.user_created',
            new UserCreatedEvent($user)
        );
    }
}
</code></pre>

<p>Notice that the UserRepository class does not know about the DecoratedUserRepository class existence, and this is very important! Now it is already possible to use it wherever we want, but there is still the need of updating every reference to the old repository class to the new one, which makes the maintenance process much harder and complex...</p>

<p>And this complexity is what the Symfony's Service Decoration feature is meant to tackle!</p>

<p>To configure it is very simple. See the services.yml file example below:</p>

<pre><code class="language-yaml">services:  
    app.user_repository:
        class: App\UserBundle\Repository\UserRepository
        arguments:
            - '@doctrine.orm.entity_manager'

    app.decorated_user_repository:
        class: App\UserBundle\Repository\DecoratedUserRepository
        decorates: app.user_repository
        public: false
        arguments: 
            - '@app.user_repository.inner'
            - '@app.event_dispatcher'
</code></pre>

<p>The attribute "<strong>decorates</strong>" makes the original service definition to be overwritten by the new service. This means that when the service "<strong>app.user_repository</strong>" is requested, the service "<strong>app.decorated_user_repository</strong>" will be the one being used.</p>

<p>I hope this was as helpful for you as it was for me! For detailed information about the usage of this feature, take a look at the <a href="https://symfony.com/doc/current/service_container/service_decoration.html">documentation</a>.</p>

<p>See you!</p>
        </section>

        <footer class="post-footer">


            <figure class="author-image">
                <a class="img" href="../author/marcelsud/" style="background-image: url(../content/images/2017/08/profile_licture.jpg)"><span class="hidden">Marcelo Santos's Picture</span></a>
            </figure>

            <section class="author">
                <h4><a href="../author/marcelsud/">Marcelo Santos</a></h4>

                    <p>PHP Developer, Symfony lover, Geek, Husband and Dad!</p>
                <div class="author-meta">
                    <span class="author-location icon-location">Berlin, Germany</span>
                    <span class="author-link icon-link"><a href="http://marcelsud.com">http://marcelsud.com</a></span>
                </div>
            </section>




        <section class="post-comments">
              <div id="disqus_thread"></div>
              <script type="text/javascript">
              // required: replace example with your forum shortname
              if(disqus_shortname && typeof disqus_shortname === "string") {
                  var disqus_identifier = '';

                  /* * * DON'T EDIT BELOW THIS LINE * * */
                  (function() {
                  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
              }
              </script>
              <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        </section>

        </footer>

    </article>
</main>

<aside class="read-next">
    <a class="read-next-story prev " style="background-image: url(../content/images/2016/11/rsz_1welcome-backgrounds-for-church-services1.jpg)" href="../welcome-to-php/">
        <section class="post">
            <h2>Welcome to PHP</h2>
            <p>Hey everybody! After some months without writing anything here I decided to get it back on track and start…</p>
        </section>
    </a>
</aside>




        <footer class="site-footer clearfix">
            <section class="copyright"><a href="http://marcelsud.com">Marcelo Santos (@marcelsud)</a> © 2017</section>
            <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
        </footer>

    </div>

    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

    <script type="text/javascript" src="../assets/js/jquery.fitvids.js?v=b26ed48682"></script>
    <script type="text/javascript" src="../assets/js/index.js?v=b26ed48682"></script>
    <script type="text/javascript" src="../assets/js/prism.js?v=b26ed48682"></script>
    <script type="text/javascript" src="../assets/js/rrssb.min.js?v=b26ed48682"></script>

    <script type="text/javascript">
        jQuery(document).ready(function($) {

            $('.rrssb-buttons').rrssb({
                // required:
                title: 'Service Decoration with Symfony 2/3',
                url: 'http://marcelsud.com/service-decoration-with-symfony-2-3/',

                // optional:
                 description: 'Service Decoration with Symfony 2/3',
                // emailBody: 'Usually email body is just the description + url, but you can customize it if you want'
            });

        });
    </script>

    <script>
        // TO ACTIVATE ADD var ga_id = "your_ga_id" to ghost code injection header
        if (window.ga_id) {
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
            ga('create', window.ga_id, 'auto');
            ga('require', 'linkid', 'linkid.js');
            ga('send', 'pageview');
        }
    </script>

    <script>
        if(window.social_link){
            var url_regexp = /^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/
            $.each(window.social_link,function(type, url){
                if(typeof url ==="string" && url_regexp.test(url)){
                    $('<li>').append($('<a>',{
                                        html: '<i class="fa fa-'+type+'"></i>',
                                        title: type,
                                        href: url,
                                        target: "_blank"
                                    })
                                ).appendTo('.social_link');

                }
            })
        }
    </script>

</body>
